-- Oracle SQL Schema
CREATE TABLE users (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    username VARCHAR2(50) UNIQUE NOT NULL,
    master_password_hash VARCHAR2(255) NOT NULL,
    name VARCHAR2(100),
    email VARCHAR2(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE credentials (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id NUMBER NOT NULL,
    account_name VARCHAR2(100) NOT NULL,
    username VARCHAR2(100),
    encrypted_password VARCHAR2(500) NOT NULL, -- Base64 encoded
    url VARCHAR2(255),
    notes CLOB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP,
    CONSTRAINT fk_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

CREATE TABLE security_questions (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id NUMBER NOT NULL,
    question VARCHAR2(255) NOT NULL,
    answer_hash VARCHAR2(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_user_sq FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
-- Create VERIFICATION_CODES table
CREATE TABLE VERIFICATION_CODES (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    USER_ID NUMBER NOT NULL,
    CODE VARCHAR2(6) NOT NULL,
    PURPOSE VARCHAR2(50) NOT NULL,
    EXPIRY_TIME TIMESTAMP NOT NULL,
    IS_USED NUMBER(1) DEFAULT 0,
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT FK_VC_USER FOREIGN KEY (USER_ID) REFERENCES USERS(ID) ON DELETE CASCADE
);

-- Index for searching (optional but recommended)
CREATE INDEX IDX_VC_USER_CODE ON VERIFICATION_CODES(USER_ID, CODE);
